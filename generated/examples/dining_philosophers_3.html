<!DOCTYPE html>
<html>
<!--
  Generated by: test/dining_philosophers_test.exs
  Test: Dining Philosophers simulation generates viewable Mermaid diagram for 3 philosophers
  Generator: unknown
-->
<head>
  <meta charset="utf-8">
  <title>3 Philosophers (Small Table) - Dining Philosophers</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-elixir.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-mermaid.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 1600px;
      margin: 0 auto;
      padding: 40px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    .subtitle {
      color: #7f8c8d;
      font-size: 1.2em;
      margin-bottom: 30px;
    }
    .info {
      background: #e8f5e9;
      padding: 20px;
      border-left: 4px solid #4caf50;
      margin-bottom: 30px;
      border-radius: 4px;
    }
    .info strong {
      color: #2e7d32;
    }
    .diagram-container {
      background: #fafafa;
      padding: 40px;
      border-radius: 8px;
      overflow-x: auto;
      margin-bottom: 30px;
    }
    .mermaid {
      display: flex;
      justify-content: center;
    }
    .explanation {
      background: #fff3e0;
      padding: 20px;
      border-left: 4px solid #ff9800;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .explanation h3 {
      margin-top: 0;
      color: #e65100;
    }
    .code-block {
      background: #263238;
      color: #aed581;
      padding: 20px;
      border-radius: 4px;
      overflow-x: auto;
    }
    pre {
      margin: 0;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .legend-item {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      border-left: 3px solid #2196f3;
    }
    .legend-item strong {
      color: #1976d2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üç¥ 3 Philosophers (Small Table)</h1>
    <div class="subtitle">Dining Philosophers Problem simulated with virtual time</div>

    <div class="info">
      <strong>üé¨ GenServerVirtualTime Actor Simulation</strong><br>
      This diagram shows the interactions between philosophers and forks over virtual time.
      All synchronous fork requests, grants, and releases are captured.
    </div>

    

    <div class="explanation">
      <h3>The Problem</h3>
      <p>
        3 philosophers sit at a round table with 3 forks between them.
        Each philosopher alternates between <strong>thinking</strong> and <strong>eating</strong>.
        To eat, a philosopher needs <strong>both adjacent forks</strong>.
      </p>
      <p>
        <strong>Challenge:</strong> How to prevent deadlock when all philosophers
        simultaneously grab their left fork? This would create a circular wait condition.
      </p>
      <p>
        <strong>Solution:</strong> Asymmetric fork acquisition strategy - odd-numbered philosophers grab
        their right fork first, even-numbered philosophers grab their left fork first.
        This breaks the symmetry and prevents circular deadlock.
      </p>
    </div>

    <div class="legend">
      <div class="legend-item">
        <strong>‚Üí</strong> Solid Arrow<br>
        Synchronous call (request/release fork)
      </div>
      <div class="legend-item">
        <strong>Activation Box</strong><br>
        Fork is processing a request
      </div>
      <div class="legend-item">
        <strong>Timestamps</strong><br>
        Virtual time progression
      </div>
      <div class="legend-item">
        <strong>Self-loops</strong><br>
        Philosopher internal state changes
      </div>
    </div>

    <div class="diagram-container">
      <div class="mermaid">
sequenceDiagram
    philosopher_2->>philosopher_2: {:start_hungry, :fork_2, :fork_0}
    Note over philosopher_2,philosopher_2: t=200ms
    philosopher_1->>philosopher_1: {:start_hungry, :fork_2, :fork_1}
    Note over philosopher_1,philosopher_1: t=200ms
    philosopher_0->>philosopher_0: {:start_hungry, :fork_0, :fork_1}
    Note over philosopher_0,philosopher_0: t=200ms
    philosopher_2->>philosopher_2: {:mumble, "I'm hungry!"}
    Note over philosopher_2,philosopher_2: t=200ms
    philosopher_1->>philosopher_1: {:mumble, "I'm hungry!"}
    Note over philosopher_1,philosopher_1: t=200ms
    philosopher_0->>philosopher_0: {:mumble, "I'm hungry!"}
    Note over philosopher_0,philosopher_0: t=200ms
    philosopher_2->>fork_2: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=200ms
    philosopher_1->>fork_2: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=200ms
    philosopher_0->>fork_0: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=200ms
    fork_2->>philosopher_2: {:fork_granted, :fork_2}
    Note over fork_2,philosopher_2: t=200ms
    fork_0->>philosopher_0: {:fork_granted, :fork_0}
    Note over fork_0,philosopher_0: t=200ms
    fork_2->>philosopher_1: {:fork_denied, :fork_2}
    Note over fork_2,philosopher_1: t=200ms
    philosopher_2->>fork_0: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_0: t=200ms
    philosopher_0->>fork_1: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=200ms
    fork_0->>philosopher_2: {:fork_denied, :fork_0}
    Note over fork_0,philosopher_2: t=200ms
    fork_1->>philosopher_0: {:fork_granted, :fork_1}
    Note over fork_1,philosopher_0: t=200ms
    philosopher_2->>fork_2: {:release_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=200ms
    philosopher_0->>philosopher_0: {:mumble, "I'm full!"}
    Note over philosopher_0,philosopher_0: t=300ms
    philosopher_0->>fork_0: {:release_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=300ms
    philosopher_0->>fork_1: {:release_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=300ms
    philosopher_0->>philosopher_0: {:start_hungry, :fork_0, :fork_1}
    Note over philosopher_0,philosopher_0: t=400ms
    philosopher_1->>philosopher_1: {:start_hungry, :fork_2, :fork_1}
    Note over philosopher_1,philosopher_1: t=400ms
    philosopher_0->>fork_0: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=400ms
    philosopher_1->>fork_2: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=400ms
    philosopher_2->>philosopher_2: {:start_hungry, :fork_2, :fork_0}
    Note over philosopher_2,philosopher_2: t=400ms
    philosopher_2->>fork_2: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=400ms
    fork_0->>philosopher_0: {:fork_granted, :fork_0}
    Note over fork_0,philosopher_0: t=400ms
    fork_2->>philosopher_1: {:fork_granted, :fork_2}
    Note over fork_2,philosopher_1: t=400ms
    fork_2->>philosopher_2: {:fork_denied, :fork_2}
    Note over fork_2,philosopher_2: t=400ms
    philosopher_0->>fork_1: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=400ms
    philosopher_1->>fork_1: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_1: t=400ms
    fork_1->>philosopher_0: {:fork_granted, :fork_1}
    Note over fork_1,philosopher_0: t=400ms
    fork_1->>philosopher_1: {:fork_denied, :fork_1}
    Note over fork_1,philosopher_1: t=400ms
    philosopher_1->>fork_2: {:release_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=400ms
    philosopher_0->>philosopher_0: {:mumble, "I'm full!"}
    Note over philosopher_0,philosopher_0: t=500ms
    philosopher_0->>fork_0: {:release_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=500ms
    philosopher_0->>fork_1: {:release_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=500ms
    philosopher_2->>philosopher_2: {:start_hungry, :fork_2, :fork_0}
    Note over philosopher_2,philosopher_2: t=600ms
    philosopher_1->>philosopher_1: {:start_hungry, :fork_2, :fork_1}
    Note over philosopher_1,philosopher_1: t=600ms
    philosopher_0->>philosopher_0: {:start_hungry, :fork_0, :fork_1}
    Note over philosopher_0,philosopher_0: t=600ms
    philosopher_0->>fork_0: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=600ms
    fork_0->>philosopher_0: {:fork_granted, :fork_0}
    Note over fork_0,philosopher_0: t=600ms
    philosopher_2->>fork_2: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=600ms
    philosopher_1->>fork_2: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=600ms
    philosopher_0->>fork_1: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=600ms
    fork_2->>philosopher_2: {:fork_granted, :fork_2}
    Note over fork_2,philosopher_2: t=600ms
    fork_2->>philosopher_1: {:fork_denied, :fork_2}
    Note over fork_2,philosopher_1: t=600ms
    philosopher_2->>fork_0: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_0: t=600ms
    fork_0->>philosopher_2: {:fork_denied, :fork_0}
    Note over fork_0,philosopher_2: t=600ms
    philosopher_2->>fork_2: {:release_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=600ms
    fork_1->>philosopher_0: {:fork_granted, :fork_1}
    Note over fork_1,philosopher_0: t=600ms
    philosopher_1->>philosopher_1: {:start_hungry, :fork_2, :fork_1}
    Note over philosopher_1,philosopher_1: t=800ms
    philosopher_2->>philosopher_2: {:start_hungry, :fork_2, :fork_0}
    Note over philosopher_2,philosopher_2: t=800ms
    philosopher_1->>fork_2: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=800ms
    philosopher_2->>fork_2: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=800ms
    fork_2->>philosopher_1: {:fork_granted, :fork_2}
    Note over fork_2,philosopher_1: t=800ms
    fork_2->>philosopher_2: {:fork_denied, :fork_2}
    Note over fork_2,philosopher_2: t=800ms
    philosopher_1->>fork_1: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_1: t=800ms
    fork_1->>philosopher_1: {:fork_denied, :fork_1}
    Note over fork_1,philosopher_1: t=800ms
    philosopher_1->>fork_2: {:release_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=800ms
    philosopher_0->>philosopher_0: {:start_hungry, :fork_0, :fork_1}
    Note over philosopher_0,philosopher_0: t=800ms
    philosopher_0->>fork_0: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=800ms
    fork_0->>philosopher_0: {:fork_denied, :fork_0}
    Note over fork_0,philosopher_0: t=800ms
    philosopher_0->>philosopher_0: {:mumble, "I'm full!"}
    Note over philosopher_0,philosopher_0: t=900ms
    philosopher_0->>fork_0: {:release_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=900ms
    philosopher_0->>fork_1: {:release_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=900ms
    philosopher_0->>philosopher_0: {:start_hungry, :fork_0, :fork_1}
    Note over philosopher_0,philosopher_0: t=1000ms
    philosopher_0->>fork_0: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_0: t=1000ms
    fork_0->>philosopher_0: {:fork_granted, :fork_0}
    Note over fork_0,philosopher_0: t=1000ms
    philosopher_0->>fork_1: {:request_fork, :philosopher_0}
    Note over philosopher_0,fork_1: t=1000ms
    fork_1->>philosopher_0: {:fork_granted, :fork_1}
    Note over fork_1,philosopher_0: t=1000ms
    philosopher_2->>philosopher_2: {:start_hungry, :fork_2, :fork_0}
    Note over philosopher_2,philosopher_2: t=1000ms
    philosopher_2->>fork_2: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=1000ms
    philosopher_1->>philosopher_1: {:start_hungry, :fork_2, :fork_1}
    Note over philosopher_1,philosopher_1: t=1000ms
    fork_2->>philosopher_2: {:fork_granted, :fork_2}
    Note over fork_2,philosopher_2: t=1000ms
    philosopher_1->>fork_2: {:request_fork, :philosopher_1}
    Note over philosopher_1,fork_2: t=1000ms
    fork_2->>philosopher_1: {:fork_denied, :fork_2}
    Note over fork_2,philosopher_1: t=1000ms
    philosopher_2->>fork_0: {:request_fork, :philosopher_2}
    Note over philosopher_2,fork_0: t=1000ms
    fork_0->>philosopher_2: {:fork_denied, :fork_0}
    Note over fork_0,philosopher_2: t=1000ms
    philosopher_2->>fork_2: {:release_fork, :philosopher_2}
    Note over philosopher_2,fork_2: t=1000ms
      </div>
    </div>

    <div class="explanation" style="margin-top: 30px;">
      <h3>Simulation Source Code</h3>
      <pre><code class="language-elixir">simulation =
DiningPhilosophers.create_simulation(
num_philosophers: 3,
think_time: 150,
eat_time: 75,
trace: true
)
|> ActorSimulation.run(duration: 800)</code></pre>
    </div>

    <div class="explanation" style="margin-top: 20px;">
      <h3>What the Diagram Shows</h3>
      <ul>
        <li>Each philosopher sends synchronous <code>:request_fork</code> messages to forks</li>
        <li>Forks reply with <code>:fork_granted</code> or <code>:fork_denied</code></li>
        <li>After eating, philosophers send <code>:release_fork</code> to both forks</li>
        <li>The timeline shows how virtual time advances instantly in tests</li>
        <li>No deadlocks occur due to asymmetric fork acquisition</li>
      </ul>
    </div>
  </div>

  <div class="source-links" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
    <h3 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 1.1em;">üîó Source & Links</h3>
    <a href="https://github.com/d-led/gen_server_virtual_time" target="_blank" style="display: inline-block; margin: 5px 10px 5px 0; padding: 8px 16px; background: #24292e; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.2s;">üìö GitHub Repository</a>
    <a href="https://github.com/d-led/gen_server_virtual_time/blob/main/test/dining_philosophers_test.exs" target="_blank" style="display: inline-block; margin: 5px 10px 5px 0; padding: 8px 16px; background: #24292e; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.2s;">üß™ Test Source</a>
    <a href="https://hexdocs.pm/gen_server_virtual_time" target="_blank" style="display: inline-block; margin: 5px 10px 5px 0; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.2s;">üìñ Documentation</a>
    <a href="https://hex.pm/packages/gen_server_virtual_time" target="_blank" style="display: inline-block; margin: 5px 10px 5px 0; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.2s;">üì¶ Hex Package</a>
  </div>

  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      sequence: {
        diagramMarginX: 50,
        diagramMarginY: 10,
        boxTextMargin: 5,
        noteMargin: 10,
        messageMargin: 35,
        mirrorActors: true,
        actorFontSize: 14,
        messageFontSize: 13
      }
    });
  </script>
</body>
</html>
